# mud-16

a little retro console with a Motorola 68000 and FPGA PPU

# firmware

`ppu.sv` is the Verilog code for the PPU. This is close to what will be the renderer of the game console. `main.cpp` is currently a test bench that gets the display output from the PPU and renders it with Raylib, as well as simulating the CPU bus arbitration and SRAM VRAM access

# features

-   3.5" IPS Display
-   D-pad and ABXY buttons
-   27 MHz FPGA
-   Rechargable Battery
-   512 KB of SRAM

## why

I think that the GameBoy and other retro game console are really cool, and I want to make my own console. But I didn't want to just emulate it, I wanted to use a real retro CPU and make my own PPU (picture processing unit) with a FPGA.

## how

The CPU is the brain pretty much. It handles all the game logic and stuff. It's connected to 512 KB of SRAM which the first part of it is allocated to VRAM. The VRAM is used by the FPGA. The CPU needs to go through level shifters down to 3.3V, and the CPU and FPGA needs to handle bus arbitration properly, otherwise they will fight over the bus and everything will become a mess. The FPGA will request for the bus at the beginning of each frame where they will essentially perform a handshake and the bus will be passed to the FPGA. The FPGA then accesses all the VRAM it needs and then gives back control to the CPU.

The display will be running in 8 bit parallel mode, since SPI is too slow.

## to use

this stuff is WIP

you'll need to flash everything to the FPGA which will load all the necessary data into RAM for the CPU. The Gowin IDE is the app you'll use to flash the Tang Nano.

<img width="969" height="708" alt="image" src="https://github.com/user-attachments/assets/e5b9deb2-64ed-4b95-a4d6-570b346a1224" />

<img width="776" height="844" alt="image" src="https://github.com/user-attachments/assets/61a36859-6648-4163-92f0-3ed2e4d5f020" />

<img width="634" height="749" alt="image" src="https://github.com/user-attachments/assets/30c8e158-cffe-47ef-a230-8aa019040ac9" />


<img width="668" height="683" alt="image" src="https://github.com/user-attachments/assets/aebc0cff-6ab6-47be-a35c-bd22d35141ee" />


| Item                 | Quantity | Cost   | Link                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Notes                                                                    |
| -------------------- | -------- | ------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------ |
| PCB + PCBA           | 2        | $50.32 | https://jlcpcb.com/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Two PCBs for the second rev, which will be thinner and fix possible bugs |
| AMS1117-3.3          | 1        | $0.32  | AMS1117-3.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Buck Converter                                                           |
| AMS1117-1.8          | 1        | $0.32  | AMS1117-1.8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Buck Converter                                                           |
| 74LVC1G04GV          | 2        | $0.10  | 74LVC1G04GV                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Shift Register                                                           |
| SN74LVC8T245PW       | 7        | $1.92  | SN74LVC8T245PW                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Level Shifter                                                            |
| Female Pin Header    | 1        | $2.44  | https://www.aliexpress.us/item/2255801012106911.html?spm=a2g0o.productlist.main.1.54beh8sZh8sZ7H&algo_pvid=d19413e4-cb57-4409-9f13-5f06f911b4db&algo_exp_id=d19413e4-cb57-4409-9f13-5f06f911b4db-0&pdp_ext_f={%22order%22%3A%223846%22%2C%22eval%22%3A%221%22%2C%22fromPage%22%3A%22search%22}&pdp_npi=6%40dis!USD!1.30!1.27!!!1.30!1.27!%402103126e17658458343235087e8388!10000015275671643!sea!US!2891746612!X!1!0!n_tag%3A-29919%3Bd%3A25ee0dc0%3Bm03_new_user%3A-29895&curPageLogUid=q13fcpg1TWGx&utparam-url=scene%3Asearch&#124;query_from%3A&#124;x_object_id%3A4001198421663&#124;_p_origin_prod%3A  | 1x40 Female Pin Header                                                   |
| MC68000P12 DIP-64    | 1        | $16.96 | https://www.ebay.com/itm/315746399382?_skw=MC68000P12&itmmeta=01KCJA2ZDMD3JFW4K6QCRVRQGD&hash=item4983f3b496:g:u3AAAOSwWzRm1bXI&itmprp=enc%3AAQAKAAAA8FkggFvd1GGDu0w3yXCmi1dyBzJmEOzWwtz1nOYvUl%2BV%2BkQCWUhcbtbof%2B21NOauZ5ZlLKtd7xe%2BDRH41psQzul%2FwDPyp5SyK3SICMxXqHesQ820zf6R6icb8ZH7pKzj0xGks89HbRtiTGg2xshmb364Qmjtfe3r5cJcQYrSTARVOnMZ0ugrLWVhlu3M4yMq9hRGeEu2%2F8bxJS0cbWyUrDbC6q%2F6vywsAWIMhUNIf0H0nBeEzi1I6L2FkJP2JbnSqg90208l4QC%2FOxb2DPnc0J9vgzThC8UBSY%2FZjx38oLtyNRcPKXUuT5ubDAL7T0HZfA%3D%3D&#124;tkp%3ABFBMiveLyuRm                                                                      | m68k CPU 12 MHz                                                          |
| Helping Hands        | 1        | $8.62  | https://www.aliexpress.us/item/3256806823951370.html?spm=a2g0o.cart.0.0.162038da3R7bva&mp=1&pdp_npi=5%40dis!USD!USD%2017.23!USD%208.62!!USD%208.62!!!%402103274e17658469136554395edac7!12000039049066525!ct!US!2891746612!!1!0&gatewayAdapt=glo2usa                                                                                                                                                                                                                                                                                                                                                          | hands                                                                    |
| Logic Analyzer       | 1        | $5.03  | https://www.aliexpress.us/item/3256806925807843.html?spm=a2g0o.cart.0.0.162038da3R7bva&mp=1&pdp_npi=5%40dis!USD!USD%205.03!USD%205.03!!USD%205.03!!!%402103274e17658469136554395edac7!12000039443946717!ct!US!2891746612!!1!0&gatewayAdapt=glo2usa                                                                                                                                                                                                                                                                                                                                                           | Logic Analyzer                                                           |
| ILI9488 IPS No Touch | 1        | $7.67  | https://www.aliexpress.us/item/3256804339619267.html?spm=a2g0o.cart.0.0.162038da3R7bva&mp=1&pdp_npi=5%40dis!USD!USD%207.67!USD%207.67!!USD%207.67!!!%402103274e17658469136554395edac7!12000029476842562!ct!US!2891746612!!1!0&gatewayAdapt=glo2usa                                                                                                                                                                                                                                                                                                                                                           | Display                                                                  |
| IC DIP Sockets       | 1        | $5.82  | https://www.aliexpress.us/item/3256806149124857.html?spm=a2g0o.productlist.main.3.367f1666vkcIUl&algo_pvid=733ce6a9-0f7e-45bd-8a2b-3fed5976ca96&algo_exp_id=733ce6a9-0f7e-45bd-8a2b-3fed5976ca96-2&pdp_ext_f={%22order%22%3A%2232%22%2C%22eval%22%3A%221%22%2C%22fromPage%22%3A%22search%22}&pdp_npi=6%40dis!USD!0.98!0.98!!!6.88!6.88!%40210311a017658475262903951edaad!12000036800785975!sea!US!2891746612!X!1!0!n_tag%3A-29919%3Bd%3A25ee0dc0%3Bm03_new_user%3A-29895&curPageLogUid=54rKMPKbiLkA&utparam-url=scene%3Asearch&#124;query_from%3A&#124;x_object_id%3A1005006335439609&#124;_p_origin_prod%3A | DIP16 sockets                                                            |
| Misc                 | N/A      | ~$5?   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Resistors, Caps, Buttons, etc                                            |
| AS7C3513B-12TCN      | 2        | $19.88 | https://www.mouser.com/ProductDetail/Alliance-Memory/AS7C3513B-12TCN?qs=E5c5%252Bmu3i3%252BBrpzFfz%2FKzg%3D%3D                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | SRAM                                                                     |
| FH12-40S-0.5SH(55)   | 1        | $0.62  | https://jlcpcb.com/partdetail/HRS_Hirose-FH12_40S_0_5SH_55/C202114                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 40 Pin FPC Connector (display)                                           |
